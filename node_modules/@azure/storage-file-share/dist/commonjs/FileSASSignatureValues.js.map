{"version":3,"file":"FileSASSignatureValues.js","sourceRoot":"","sources":["../../src/FileSASSignatureValues.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { StorageSharedKeyCredential, UserDelegationKey } from \"@azure/storage-common\";\nimport { FileSASPermissions } from \"./FileSASPermissions.js\";\nimport type { SasIPRange } from \"./SasIPRange.js\";\nimport { ipRangeToString } from \"./SasIPRange.js\";\nimport type { SASProtocol } from \"./SASQueryParameters.js\";\nimport { SASQueryParameters } from \"./SASQueryParameters.js\";\nimport { ShareSASPermissions } from \"./ShareSASPermissions.js\";\nimport { SERVICE_VERSION } from \"./utils/constants.js\";\nimport { truncatedISO8061Date } from \"./utils/utils.common.js\";\nimport { UserDelegationKeyCredential } from \"@azure/storage-common\";\n\n/**\n * ONLY AVAILABLE IN NODE.JS RUNTIME.\n *\n * FileSASSignatureValues is used to help generating File service SAS tokens for shares or files.\n */\n\nexport interface FileSASSignatureValues {\n  /**\n   * The version of the service this SAS will target. If not specified, it will default to the version targeted by the\n   * library.\n   */\n  version?: string;\n\n  /**\n   * Optional. SAS protocols, HTTPS only or HTTPSandHTTP\n   */\n  protocol?: SASProtocol;\n\n  /**\n   * Optional. When the SAS will take effect.\n   */\n  startsOn?: Date;\n\n  /**\n   * Optional only when identifier is provided. The time after which the SAS will no longer work.\n   */\n  expiresOn?: Date;\n\n  /**\n   * Optional only when identifier is provided.\n   * Please refer to either {@link ShareSASPermissions} or {@link FileSASPermissions} depending on the resource\n   * being accessed for help constructing the permissions string.\n   */\n  permissions?: FileSASPermissions | ShareSASPermissions;\n\n  /**\n   * Optional. IP ranges allowed in this SAS.\n   */\n  ipRange?: SasIPRange;\n\n  /**\n   * The name of the share the SAS user may access.\n   */\n  shareName: string;\n\n  /**\n   * Optional. The path of the file like, \"directory/FileName\" or \"FileName\".\n   */\n  filePath?: string;\n\n  /**\n   * Optional. The name of the access policy on the share this SAS references if any.\n   *\n   * @see https://learn.microsoft.com/rest/api/storageservices/establishing-a-stored-access-policy\n   */\n  identifier?: string;\n\n  /**\n   * Optional. Beginning in version 2025-07-05, this value specifies the Entra ID of the user who is authorized to\n   * use the resulting SAS URL.  The resulting SAS URL must be used in conjunction with an Entra ID token that has been\n   * issued to the user specified in this value.\n   */\n  delegatedUserObjectId?: string;\n\n  /**\n   * Optional. The cache-control header for the SAS.\n   */\n  cacheControl?: string;\n\n  /**\n   * Optional. The content-disposition header for the SAS.\n   */\n  contentDisposition?: string;\n\n  /**\n   * Optional. The content-encoding header for the SAS.\n   */\n  contentEncoding?: string;\n\n  /**\n   * Optional. The content-language header for the SAS.\n   */\n  contentLanguage?: string;\n\n  /**\n   * Optional. The content-type header for the SAS.\n   */\n  contentType?: string;\n}\n\nexport function generateFileSASQueryParameters(\n  fileSASSignatureValues: FileSASSignatureValues,\n  userDelegationKey: UserDelegationKey,\n  accountName: string,\n): SASQueryParameters;\n\nexport function generateFileSASQueryParameters(\n  fileSASSignatureValues: FileSASSignatureValues,\n  sharedKeyCredential: StorageSharedKeyCredential,\n): SASQueryParameters;\n\n/**\n * ONLY AVAILABLE IN NODE.JS RUNTIME.\n *\n * Creates an instance of SASQueryParameters.\n *\n * Only accepts required settings needed to create a SAS. For optional settings please\n * set corresponding properties directly, such as permissions, startsOn and identifier.\n *\n * WARNING: When identifier is not provided, permissions and expiresOn are required.\n * You MUST assign value to identifier or expiresOn & permissions manually if you initial with\n * this constructor.\n *\n * @param fileSASSignatureValues -\n * @param sharedKeyCredential -\n */\n\nexport function generateFileSASQueryParameters(\n  fileSASSignatureValues: FileSASSignatureValues,\n  sharedKeyCredentialOrUserDelegationKey: StorageSharedKeyCredential | UserDelegationKey,\n  accountName?: string,\n): SASQueryParameters {\n  return generateFileSASQueryParametersInternal(\n    fileSASSignatureValues,\n    sharedKeyCredentialOrUserDelegationKey,\n    accountName,\n  ).sasQueryParameters;\n}\n\nexport function generateFileSASQueryParametersInternal(\n  fileSASSignatureValues: FileSASSignatureValues,\n  sharedKeyCredentialOrUserDelegationKey: StorageSharedKeyCredential | UserDelegationKey,\n  accountName?: string,\n): { sasQueryParameters: SASQueryParameters; stringToSign: string } {\n  const version = fileSASSignatureValues.version ? fileSASSignatureValues.version : SERVICE_VERSION;\n\n  const sharedKeyCredential =\n    sharedKeyCredentialOrUserDelegationKey instanceof StorageSharedKeyCredential\n      ? sharedKeyCredentialOrUserDelegationKey\n      : undefined;\n  let userDelegationKeyCredential: UserDelegationKeyCredential | undefined;\n\n  if (sharedKeyCredential === undefined && accountName !== undefined) {\n    userDelegationKeyCredential = new UserDelegationKeyCredential(\n      accountName,\n      sharedKeyCredentialOrUserDelegationKey as UserDelegationKey,\n    );\n  }\n\n  if (sharedKeyCredential !== undefined) {\n    return generateFileSASQueryParametersDefault(fileSASSignatureValues, sharedKeyCredential!);\n  } else {\n    if (version >= \"2025-07-05\") {\n      return generateFileSASQueryParametersUDK20250705(\n        fileSASSignatureValues,\n        userDelegationKeyCredential!,\n        accountName!,\n      );\n    } else {\n      throw new RangeError(\n        \"'version' must be >= '2025-07-05' when generating user delegation SAS using user delegation key.\",\n      );\n    }\n  }\n}\n\nexport function generateFileSASQueryParametersDefault(\n  fileSASSignatureValues: FileSASSignatureValues,\n  sharedKeyCredential: StorageSharedKeyCredential,\n): { sasQueryParameters: SASQueryParameters; stringToSign: string } {\n  if (\n    !fileSASSignatureValues.identifier &&\n    !(fileSASSignatureValues.permissions && fileSASSignatureValues.expiresOn)\n  ) {\n    throw new RangeError(\n      \"Must provide 'permissions' and 'expiresOn' for File SAS generation when 'identifier' is not provided.\",\n    );\n  }\n\n  const version = fileSASSignatureValues.version ? fileSASSignatureValues.version : SERVICE_VERSION;\n  let resource: string = \"s\";\n  if (fileSASSignatureValues.filePath) {\n    resource = \"f\";\n  }\n\n  let verifiedPermissions: string | undefined;\n  // Calling parse and toString guarantees the proper ordering and throws on invalid characters.\n  if (fileSASSignatureValues.permissions) {\n    if (fileSASSignatureValues.filePath) {\n      verifiedPermissions = FileSASPermissions.parse(\n        fileSASSignatureValues.permissions.toString(),\n      ).toString();\n    } else {\n      verifiedPermissions = ShareSASPermissions.parse(\n        fileSASSignatureValues.permissions.toString(),\n      ).toString();\n    }\n  }\n\n  // Signature is generated on the un-url-encoded values.\n  const stringToSign = [\n    verifiedPermissions,\n    fileSASSignatureValues.startsOn\n      ? truncatedISO8061Date(fileSASSignatureValues.startsOn, false)\n      : \"\",\n    fileSASSignatureValues.expiresOn\n      ? truncatedISO8061Date(fileSASSignatureValues.expiresOn, false)\n      : \"\",\n    getCanonicalName(\n      sharedKeyCredential.accountName,\n      fileSASSignatureValues.shareName,\n      fileSASSignatureValues.filePath,\n    ),\n    fileSASSignatureValues.identifier,\n    fileSASSignatureValues.ipRange ? ipRangeToString(fileSASSignatureValues.ipRange) : \"\",\n    fileSASSignatureValues.protocol,\n    version,\n    fileSASSignatureValues.cacheControl,\n    fileSASSignatureValues.contentDisposition,\n    fileSASSignatureValues.contentEncoding,\n    fileSASSignatureValues.contentLanguage,\n    fileSASSignatureValues.contentType,\n  ].join(\"\\n\");\n\n  const signature = sharedKeyCredential.computeHMACSHA256(stringToSign);\n\n  return {\n    sasQueryParameters: new SASQueryParameters(\n      version,\n      signature,\n      verifiedPermissions,\n      undefined,\n      undefined,\n      fileSASSignatureValues.protocol,\n      fileSASSignatureValues.startsOn,\n      fileSASSignatureValues.expiresOn,\n      fileSASSignatureValues.ipRange,\n      fileSASSignatureValues.identifier,\n      resource,\n      fileSASSignatureValues.cacheControl,\n      fileSASSignatureValues.contentDisposition,\n      fileSASSignatureValues.contentEncoding,\n      fileSASSignatureValues.contentLanguage,\n      fileSASSignatureValues.contentType,\n    ),\n    stringToSign: stringToSign,\n  };\n}\n\nexport function generateFileSASQueryParametersUDK20250705(\n  fileSASSignatureValues: FileSASSignatureValues,\n  userDelegationKeyCredential: UserDelegationKeyCredential,\n  accountName: string,\n): { sasQueryParameters: SASQueryParameters; stringToSign: string } {\n  if (!(fileSASSignatureValues.permissions && fileSASSignatureValues.expiresOn)) {\n    throw new RangeError(\n      \"Must provide 'permissions' and 'expiresOn' for File SAS generation when generating user delegation SAS.\",\n    );\n  }\n\n  const version = fileSASSignatureValues.version ? fileSASSignatureValues.version : SERVICE_VERSION;\n  let resource: string = \"s\";\n  if (fileSASSignatureValues.filePath) {\n    resource = \"f\";\n  }\n\n  let verifiedPermissions: string | undefined;\n  // Calling parse and toString guarantees the proper ordering and throws on invalid characters.\n  if (fileSASSignatureValues.permissions) {\n    if (fileSASSignatureValues.filePath) {\n      verifiedPermissions = FileSASPermissions.parse(\n        fileSASSignatureValues.permissions.toString(),\n      ).toString();\n    } else {\n      verifiedPermissions = ShareSASPermissions.parse(\n        fileSASSignatureValues.permissions.toString(),\n      ).toString();\n    }\n  }\n\n  // Signature is generated on the un-url-encoded values.\n  const stringToSign = [\n    verifiedPermissions,\n    fileSASSignatureValues.startsOn\n      ? truncatedISO8061Date(fileSASSignatureValues.startsOn, false)\n      : \"\",\n    fileSASSignatureValues.expiresOn\n      ? truncatedISO8061Date(fileSASSignatureValues.expiresOn, false)\n      : \"\",\n    getCanonicalName(\n      accountName,\n      fileSASSignatureValues.shareName,\n      fileSASSignatureValues.filePath,\n    ),\n    userDelegationKeyCredential.userDelegationKey.signedObjectId,\n    userDelegationKeyCredential.userDelegationKey.signedTenantId,\n    userDelegationKeyCredential.userDelegationKey.signedStartsOn\n      ? truncatedISO8061Date(userDelegationKeyCredential.userDelegationKey.signedStartsOn, false)\n      : \"\",\n    userDelegationKeyCredential.userDelegationKey.signedExpiresOn\n      ? truncatedISO8061Date(userDelegationKeyCredential.userDelegationKey.signedExpiresOn, false)\n      : \"\",\n    userDelegationKeyCredential.userDelegationKey.signedService,\n    userDelegationKeyCredential.userDelegationKey.signedVersion,\n    undefined, // shared key delegation signed tenant id.\n    fileSASSignatureValues.delegatedUserObjectId,\n    fileSASSignatureValues.ipRange ? ipRangeToString(fileSASSignatureValues.ipRange) : \"\",\n    fileSASSignatureValues.protocol,\n    version,\n    fileSASSignatureValues.cacheControl,\n    fileSASSignatureValues.contentDisposition,\n    fileSASSignatureValues.contentEncoding,\n    fileSASSignatureValues.contentLanguage,\n    fileSASSignatureValues.contentType,\n  ].join(\"\\n\");\n\n  const signature = userDelegationKeyCredential.computeHMACSHA256(stringToSign);\n\n  return {\n    sasQueryParameters: new SASQueryParameters(\n      version,\n      signature,\n      verifiedPermissions,\n      undefined,\n      undefined,\n      fileSASSignatureValues.protocol,\n      fileSASSignatureValues.startsOn,\n      fileSASSignatureValues.expiresOn,\n      fileSASSignatureValues.ipRange,\n      fileSASSignatureValues.identifier,\n      resource,\n      fileSASSignatureValues.cacheControl,\n      fileSASSignatureValues.contentDisposition,\n      fileSASSignatureValues.contentEncoding,\n      fileSASSignatureValues.contentLanguage,\n      fileSASSignatureValues.contentType,\n      userDelegationKeyCredential.userDelegationKey,\n      fileSASSignatureValues.delegatedUserObjectId,\n    ),\n    stringToSign: stringToSign,\n  };\n}\n\nfunction getCanonicalName(accountName: string, shareName: string, filePath?: string): string {\n  // Share: \"/file/account/sharename\"\n  // File:  \"/file/account/sharename/filename\"\n  // File:  \"/file/account/sharename/directoryname/filename\"\n  const elements: string[] = [`/file/${accountName}/${shareName}`];\n  if (filePath) {\n    elements.push(`/${filePath}`);\n  }\n  return elements.join(\"\");\n}\n"]}